---
import Link from "@components/Links.astro";
import { Icon } from "astro-icon/components";
import { SITE_TITLE, HeaderLinks } from "@consts";

const isDev = import.meta.env.DEV;
const base = isDev ? 'http://localhost:4321' : Astro.site?.href ?? 'https://wildgreen.blog';
const resolve = (path: string): string => new URL(path, base).href;
---

<header class="sticky top-0 z-50 bg-white dark:bg-gray-900 w-full py-5 shadow-sm">
  <nav class="max-w-4xl mx-auto px-3 flex flex-wrap items-center justify-between md:grid md:grid-cols-12" aria-label="Global">
    
    <!-- Left: Site Title -->
    <div class="md:col-span-3">
      <a 
        class="no-underline text-xl font-semibold text-neutral-900 hover:text-neutral-600 dark:text-neutral-400 dark:hover:text-neutral-200" 
        href={resolve('/')} 
        aria-label="Astroverse"
      >
        {SITE_TITLE}
      </a>
    </div>

    <!-- Mobile Toggle -->
    <div class="md:hidden">
      <button 
        type="button" 
        class="menu-toggle size-[38px] flex items-center justify-center text-black dark:text-white hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded-xl" 
        aria-controls="navbar-menu" 
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <Icon name="tabler:menu-2" class="icon-open size-5" />
        <Icon name="tabler:x" class="icon-close hidden size-5" />
      </button>
    </div>

    <!-- Right: Blog/About Menu -->
    <div 
      id="navbar-menu" 
      class="nav-links hidden w-full md:block md:col-span-9 transition-all duration-300"
    >
      <div class="flex flex-col md:flex-row md:justify-end md:items-center gap-y-3 md:gap-y-0 md:gap-x-5 mt-4 md:mt-0">
        {
          HeaderLinks.map((link) => (
            <Link
              href={resolve(link.href)}
              class="no-underline px-3 py-2 font-medium text-neutral-900 hover:text-neutral-600 dark:text-neutral-400 dark:hover:text-neutral-200"
            >
              {link.title}
            </Link>
          ))
        }
      </div>
    </div>

  </nav>
</header>

<!-- Script toggle -->
<script>
  const btn = document.querySelector('.menu-toggle');
  const menu = document.getElementById('navbar-menu');
  const iconOpen = btn.querySelector('.icon-open');
  const iconClose = btn.querySelector('.icon-close');

  btn?.addEventListener('click', () => {
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    btn.setAttribute('aria-expanded', String(!expanded));
    menu.classList.toggle('hidden');
    iconOpen.classList.toggle('hidden');
    iconClose.classList.toggle('hidden');
  });
</script>
