---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";

const allPosts = await getCollection("posts");
allPosts.sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());

const postsPerPage = 10;
const firstPagePosts = allPosts.slice(0, postsPerPage);
const totalPages = Math.ceil(allPosts.length / postsPerPage);

const type = "blogList";
const isDev = import.meta.env.DEV;
const base = isDev ? "http://localhost:4321" : Astro.site?.href ?? "https://wildgreen.blog";
const resolve = (path: string): string => new URL(path, base).href;
---

<Layout
  title="WildGreen Articles — Eco Travel Guides, Green Living Tips"
  description="Browse WildGreen’s curated articles on mindful travel, climate awareness, and sustainable living."
  type={type}
  url={resolve(Astro.url.pathname)}
  itemList={firstPagePosts.map(post => ({
    title: post.data.title,
    url: resolve(`/${post.slug || post.id}/`)
  }))}
>
  <section class="flex flex-col gap-6 mb-12 pt-12">
    <h1 class="text-2xl font-bold mb-6">Blog</h1>
    {firstPagePosts.map(post => (
      <article class="rounded-lg border border-solid border-gray-300 p-4 shadow-sm">
        <h2 class="text-3xl font-semibold mb-1">
          <a
            href={resolve(`/${post.slug || post.id}/`)}
            class="no-underline text-blue-700 hover:text-blue-500"
          >
            {post.data.title}
          </a>
        </h2>
        <p class="text-sm text-gray-500 mb-2">
          {new Date(post.data.pubDate).toLocaleDateString(undefined, {
            year: "numeric",
            month: "long",
            day: "numeric",
          })}
        </p>
        {post.data.description && (
          <p class="text-sm text-gray-700">{post.data.description}</p>
        )}
      </article>
    ))}
  </section>

  <!-- Pagination nav -->
  <nav class="flex justify-center gap-2 mt-8">
    {Array.from({ length: totalPages }).map((_, i) => {
      const page = i + 1;
      const isActive = page === 1;
      return (
        <a
          href={page === 1 ? "/blog/" : `/blog/${page}/`}
          class={`px-3 py-1 rounded ${
            isActive
              ? "bg-blue-600 text-white font-semibold"
              : "bg-gray-100 text-gray-800 hover:bg-gray-200"
          }`}
        >
          {page}
        </a>
      );
    })}
  </nav>
</Layout>
